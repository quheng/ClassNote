# Network

# Design Issue for the Layers

1. Addressing (寻址)
2. Error Control(差错控制)
3. Flow Control(流量控制)
4. Multiplexing(多路)
5. Routing(路由)

---

# Reference Models
## The OSI reference model
### OSI
Open System Interconnection:国际标准化组织（ISO）制定了OSI模型，该模型定义了不同计算机互联的标准，是设计和描述极端机网络通信的基本框架。

### model
1. Physical(ph,物理层)在物理上直接相连的两个节点之间，在多样的物理介质基础之上，利用物理介质的一些特性，为更高层次(Data Link)提供一个面向二进制文件(bit)的传输服务。
2. Data Link(数据链路层)在物理上直接相连的两个节点之间, 在物理层的基础之上,为更高层次(Network)提供面向帧(Frame)的基本无错,平滑(针对网络状况调整传输速度)的传输服务.
3. Network(网络层)在数据链路层的基础之上,将不同的数据链路串联起来,提供传输包(packet)的传输服务,实现了路由(确定传输方向),中继(如何传输),网络互联(串联链路层), 使得不直接相连的设备连接起来.
4. Transport(t,运输层)接受来自上一层的数据, 在必要时将这些数据分割成更小的单元, 然后把数据传递给网络层并确保数据正确的传递到另一端. 运输层弥补1~3层和顶层应用之间的差距, 补足1~3层的缺点.
5. Session(会话层)将网络任务分成一个个会话, 对网络过程进行组织, 增加网络的可靠性. 会话提供各种服务, 包括对话管理(dialog control 记录由谁来传递数据), 令牌控制(token management), 同步功能(synchronization).
6. Presentaion关注传递信息的语法和语义, 管理抽象的数据结构, 并允许定义和交换更高层的数据结构.
7. Application包含用户使用的各种协议如HTTP

### other
1. 4~7层在主机内完成, 1~3 层由路由器传输
2. 协议数据单元PDU(Protocol Data Unit), 4~7 层不再为数据传输单位起名字, 统称为对应层次的PDU
3. end-to-end 端对端关系, 4~7层均为端对端的关系
4. 单工: 只能向一个方向通讯 半双工: 通讯方向可以不断切换, 实现双向通信, 但同一时间只能向一个方向通信 全双工: 可以同时向两个方向通信
5. network sequence 大端(big-end)顺序

### 缺点
1. Bad timing (标准制定的时间不合适)
2. Bad techology (很多设计是出于政策而不是技术)
3. Bad implementations (过于复杂造成的笨拙和低效)
4. Bad politics (政府强加给开发者)

## TCP/IP
Transmission Control Protocol/Internet Protocol的简写，中译名为传输控制协议/因特网互联协议，又名网络通讯协议，是Internet最基本的协议、Internet国际互联网络的基础，由网络层的IP协议和传输层的TCP协议组成。TCP/IP 代表了一个协议族, TCP和IP是其中最主要的两个协议.

1. Host-to-network 链路层
2. Internet 互联网层
3. Transport 传输层
4. Application 应用层
![TCP/IP](/assets/7381a8d54cde9c9f6eb70fa9659d83a9.png)

### 缺点

1. 没有明确区分服务、接口和协议
2. TCP/IP 不通用
3. 在分层协议上下文中，链路层不是通常意义上的一层，他是一个接口
4. TCP/IP 没有区分物理层和数据链路层
5. 很多协议是自主形成的，导致先进的协议无法替代

---

# physical
## Nyquist' theorem 奈奎斯特定理
在一个无噪声的系统中，信号最高频率为H, 只需采样2H次即可，反之每秒钟最高传输2H个信息(bps)。

mainium data rate = 2B $$log_2V$$ (bits/seceg) 对于2进制信号,V = 2. 

e.g.无噪声3kHz的信道不可能超过6000bps的速率传输2进制

## 信噪比 (SNR signal-to-noise ratio)
信号功率S,噪声功率N的比值,该比率表示为对数形式$$10log_{10}S/N$$, 对数的取值单位为分贝, 10信噪比为10分贝，100信噪比为20分贝.. 声音的分贝指的是压强比。

## Shannon's formula
对于信噪比(S/N)和带宽(B)已知的信道中:

最大传输速率:bits / sec = B $$log_2 $$ (1 + S/N)
注意信噪比和分贝的转换

## 有线传输
### Twisted pairs(双绞线)
将线绞在一起是为了减少干扰

### Coaxial Cable(同轴电缆)
比双绞线传输效果要好,在光纤出现之前,远距离传输依靠同轴电缆

### power line
使用电线传输信号,插上电源即可传输信号

缺点:

1. 无法通过变压器（可以改变变压器来解决）
2. 电力负载很复杂（频繁的开关电源）对信号产生影响（难以解决）

### fibre optics(光纤)
有单模和多模之分,其中单模较好,中继距离较远。多模价格便宜,应用更为广泛。

## 无线通讯微波，长波，光波

### Satellites(卫星通信)
1. Geostationary Satellites
2. Medium-Earth Orbit Satellites
3. Low-Earth Orbit Satellites
4. Satellites Versus Fiber

### 复用
#### 频分复用（frequency division multiplex FDM）
不同的人使用不同的频率以实现复用eg.打电话时，每个人只使用0~4000Hz的频率。但是线路支持的频率远远高于4000Hz。这时便可以用0~4000，4000~8000 ...实现了线路复用正交频分复用(OFDM)

#### 时分复用(Time Division Multiplexing (TDM))
![](/assets/ef8a981676976748ef418b3bbc396eef.png)

#### 码分复用(Code Division Multiplexing (CDM))
更能容忍干扰，允许来自不同用户的多个信号共享相同的频带用不同的方式编码bit，每一个基本单位叫做码片(chip)。用不同的序列区分该bit是属于谁的，本来发送1bit变成了m bit。编码方式需要满足正交，以区分出发送方， 这个正交性可以表示为$$S \cdot T = \frac{1}{m}\Sigma^m_{i=1} S_iT_i = 0$$

![](/assets/fdb267658f1658e00966ff55df3793aa.png)

### 移动通讯系统
#### First-Generation(1G)
1. 模拟语音
2. 频分复用

#### 2G
1. 数字语音
2. 欧洲：GSM(先频分再时分), 北美：CDM

#### 3G
1. 数字语音 和 数据
2. CDM(先频分再码分) 欧洲, 联通: WCDMA 北美,电信：CDMA2000 移动：TD-SCDMA

---

# data link
数据链路层在物理层的基础上的服务在通信信道上接受和发送比特，完成如下功能:

1. 向网络层提供定义良好的服务接口
2. 处理传输错误
3. 调节数据流， 确保慢速的接收方可以稳定的接受常见的数据链路层有如下几种服务：
    1. 无确认的无连接服务，如以太网。这种服务是指原机器向目标机器发送独立的帧，目标机器并不对这些帧进行确认。
    2. 有确认的无连接服务，如802.11(wifi)。这种服务依旧没有使用逻辑连接，但每一帧都需要单独确认。
    3. 面向连接的服务，如长距通话，卫星通讯。这种服务在数据传输之前先建立一个链接，链接上每一帧都被单独编号，数据链路层确保每一帧都被对方接到。

## 成帧将比特流拆分成连续的帧，通常有如下几种做法。
1. 字节计数法 容易因为计数值传输错误引起较大的错误
2. 字节填充的标记字节法
![](/assets/2a33e3143866b63b8854d3ffd44814de.png)
3. 比特填充的标记比特法 针对2只能使用字节进行标记的缺点。比特标记使用01111110作为起止标记，若在中间出现了这样的序列，则使用比特填充进行区别。详细做法是将连续的5个1后面添加一个0，接收方剔除掉连续5个1后面的0.
4. 物理层编码违禁法

## 差错控制使用 
纠错码( error-correcting code)或检错码(error-detection code). 纠错码的信息冗余更高,但是通过可以纠错,避免了数据的重新传输,适用于错误频发的信道,如无线通讯之中。 检错码信息冗余相对较低,但是信息出错后需要重新发送,适用于光纤等出错率较低的环境。

###纠错码 
1. 海明码
2. 二进制卷积码
3. 里德所罗门码
4. 低密度奇偶校验码

### 检错码
1. 奇偶
2. 校验和
3. 循环冗余校验(CRC)

## 结构
一个帧由kind,seq,ack和info构成

1. kind 指出帧是否包含数据
2. seq 帧的顺序
3. ack 确认
4. info 控制帧的info没有用处，数据帧的info包含实际数据信息

## PPP协议特性：
1. 成帧，可以毫无歧义地区分出一帧的开始和结束
2. 链路控制，可以启动线路，测试线路，协商参数，以及当线路不再需要时温和地关闭线路。该协议称为链路控制协议(LCP, Link Control Protocol)
3. 协商网络层选项。协商方法独立于网络层协议。针对每一种支持的网络层都有一个不同的网络控制协议(NCP, Network Control Protocol)

## 介质访问控制子层
用来确定多路访问信道的下一个使用者的协议属于数据链路的一个子层，该层称为介质访问控制(MAC, Medium Access Control)

### ALOHA
#### 纯ALOHA
当用户有数据需要发送的时候就发送。这样做会带来冲突，冲突的帧会被破坏。无论何时，只要两个帧在相同的时间试图占用信道，冲突就会发生，并且两帧都会损坏。中央计算机会广播发送成功的帧，发送方需要监听是否发送成功。如果帧被损坏了，则发送方需要等待一段随机的时间重新发送该帧。
#### 分槽ALOHA
将时间分成离散的间隔，这种时间间隔被称为时间槽。每个时间槽对应一帧，这种方法要求用户最受同一的时间槽边界。取得同步时间的一种办法是由一个特殊的站在每个间隔起始时发出一个脉冲信号。与纯ALOHA不同的是，分槽ALOHA只能在离散的时间点发送信息。

### 载波侦听协议(CSP carrier sense protocal)

1. 带冲突检测的CSMA(CSMA/CD CSMA with Collision Detection)
2. 坚持载波检测多路访问(CSMA, Carrier Sense Multiple Acess)当一个站有数据要发送时，他首先侦听信道，确定当时是否有其他站正在传输数据。直到该站信道空闲时发送数据。如果发送时恰好发生冲突，则等待一段随机的时间后重新监听。
3. 非坚持CSMA(nonpersistent)如果信道当前正在使用中，不持续对信道进行监听，它会随机等待一段时间。这样避免了两个等待了很久的信道争抢刚刚空闲的信道。
4. p-坚持CSMA(p-persistent). 它适用于分时间槽的信道。如果信道是空闲的，则按照概率p发送数据，1-p的概率将此次发送推迟到下一个时间槽。如果下一个时间槽也是空闲的依旧有p的概率发送数据。
![](/assets/e1200a0c21d1210fc7dde7b4ac17dd47.png)

坚持/非坚持CSMA保证了信道忙时所有站不去传输数据，但是两个站同时监听到空闲时的冲突却无法避免

### 无冲突协议
![](/assets/ef5cdff5e0e15f7a54a621c94a23127d.png)
1. 位图协议(basic bitmap method)每个竞争期正好包含N个槽。如果0号站有数据要发送，则他在0个槽中传送1位。在这个槽中，不允许其他站发送，一般地j号站在j号槽中插入一位来声明有数据要发送。当N个槽过去后，每个站都知道了哪些站要发送数据，所以永远不会有冲突发生。
2. 令牌传递令牌代表了发送权限，如果站有个等待传输的帧队列，当它接收到令牌就可以发送帧，然后再把令牌传递到下一站。如果它没有排队的帧要传，则它只是简单地把令牌传递下去。
3. 二进制倒数基本位图协议中，每个站的开销是1位，所以该协议不可能很好地扩展到含有上千个站的网站中。
![](/assets/e9862e281e8b95cfd63af46060e0a28f.png)

### 有限竞争协议(limited-contention protocal)
负载较轻的情况下，竞争的方法延时更低。负载较重的情况下，无竞争的方法信道利用率更好。有限竞争协议在负载低时使用竞争的方法，在负载高时采用无冲突技术。自适应树遍历协议

## 无线局域网协议(wifi 802.11)
无线通信系统通常不能检测出正在发生的冲突，站接收到的信号可能很微弱，比发出去的信号弱上百万倍。

### hidden station problem & exposed station problem
![](/assets/3b3e139b457d647475f00d7904f52a5c.png)
![](/assets/12d20cdbddc45c7f8b8215bd2f746056.png)
# network
网络层关注的是如何将源数据传送到接收方. 在设计时有如下目标:

1. 向上提供的服务应独立于路由器
2. 应向上屏蔽路由器数量, 类型和拓扑关系
3. 应有一个统一的编址方案, 甚至可以跨越LAN和WAN

## 连接方式
无连接服务方式也被称为数据报(datagram)网络, 有连接方式由虚电路(VC, Virtual Circuit)实现, 被称为虚电路网路(Virtual-Circuit network)
### 无连接服务
![](/assets/81e75f228535594025542447dc2a82e9.png)
由路由器根据目标地址, 源地址和路由表来决定下一跳(hop)传向哪里.

### 有连接服务
![](/assets/fa68cb4710aac1c4682ccd6e6aa8d71a.png)
在传输之前, 先建立一个虚电路, 路由器根据连接标识符来传递数据包. 由于计算机之间不知道有哪些连接标识符被占用, 因此路由器很可能产生虚电路号冲突, 因此路由器要有更改连接标识符的能力.在一些上下文中, 这被称为标签交换(label switching). 一种被应用在ISP中的服务例子是MPLS(multiprotocol label switching).

### 比较
![](/assets/b0f01cc84c28a3a6cf424cd3d6eccd47.png)
数据报网路和虚电路网路的选择需要考虑连接建立时间和地址解析时间. 虚电路网路在建立时需要花费较大的资源, 但是处理一个数据包是很简单的事情, 数据报网路反之.

## 路由算法
### 分类
1. 非自适应算法不会根据目前的流量和网络拓扑结构来更新路由表. 路由表是预先离线情况下计算好的, 并在网络启动的时候下载到路由器中, 因此也被称为静态路由(static routing)
2. 自适应算法 根据网络变化自动改变路由表.###优化原则最优化原则(optimality principle) 和 汇集树(sink tree)

### 最短路径算法
有多种衡量距离的度量, 常用的有跳数, 物理距离, 平均延时, 带宽, 通讯成本等.

### 泛洪算法
每收到一个数据包便转发到除发送方之外所有的出境线路. 通常泛洪算法会有一个计数器进行控制(计数器为零时丢弃该包), 否则将会产生无限的数据包. 另一种抑制算法是路由器记录每一个发送过的包, 使路由器不重复发包.泛洪算法虽然实用价值不高, 但是一种有效的广播手段. 另外由于泛洪算法的鲁棒性很高, 总能找到最优路线, 因此常被用在算法性能的比较.

### 距离矢量算法
每个路由器维护一张表, 表中列出了当前已知的每个目标间的最佳距离, 以及所使用的链路. 这些表通过邻居之间相互交换信息而不断更新, 最终每个路由器都了解每个目的地的最佳链路. 这个协议被称为RIP.
![](/assets/1e4e0feb585a7cb9fdc3ee07d1bea974.png)
缺点是收敛速度非常慢, 尤其对于坏消息的发生. 当坏消息发生时(某台机器停止工作了)
![](/assets/b2e3c38ecacc5158284e930cf11bd6f0.png)
此时所有路由器的值会趋向于无穷大, 然而这可能需要无穷多次的技术. 一个并不是很好的解决方式是防止路由器返回一个从该邻居获得的最佳路径. 问题和核心是X告诉Y一条路径时, Y如何知道自己是不是在这条路径上.

### 链路状态路由(link state routing)
由于无穷计数问题, 链路状态路由取代了距离矢量路由.

1. 发现邻居路由, 并了解其网络状态
2. 设置到每个邻居的距离或成本度量值
3. 构造一个包含所有刚刚获知信息构成的数据包
4. 将这个包发送给邻居, 并接受所有来自其他路由的数据包
5. 计算出到每个节点的最短路径

### 层次路由
路由器被划分为区域(region), 每个路由器只知道区域内的路由, 但是不知道区域外的路由. 对于大型网络, 两级层次是不够的, 会划分为簇(cluster), 区(znoe), 集(group).这种划分减少了空间, 但是增加了路径长度(只能先到区域内的出口)

## 拥塞控制
### 感知路由
### 准入控制
### 流量调节
### 负载脱落

## 网络互联
### 隧道(tunneling)
![](/assets/3cd411217a31fe89cdda70ae3dec391e.png)

### 数据包分段
每个网络都会对数据包程度有限制, 不同的网络之间的限制不一. 为了传输速率, 数据包越大越好, 这就造成了可能无法通过某些网络.能到达接收方的最大数据包被称为路径最大传输单元(MTU Path Maximun Transmission Unit).一种解决方案是确保数据包大小不会超过MTU, 但是如何知道MTU是一件很难的事情.
![](/assets/5c2de71458f80b00269a5e5d11d74f59.png) 
另一种解决方案是将数据包切成小片, 但是将碎片重新组合起来很困难.

## IPv4
![](/assets/914b0950727a392894aa332516b874bc.png)

# todo




